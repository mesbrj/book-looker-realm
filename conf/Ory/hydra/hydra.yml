version: v2.2.0

# Hydra Configuration for book-looker-realm
serve:
  public:
    port: 4444
    host: 0.0.0.0
    cors:
      enabled: true
      allowed_origins:
        - "*"
      allowed_methods:
        - "GET"
        - "POST"
        - "PUT"
        - "PATCH"
        - "DELETE"
        - "HEAD"
        - "OPTIONS"
      allowed_headers:
        - "*"
      exposed_headers:
        - "*"
  admin:
    port: 4445
    host: 0.0.0.0

dsn: postgres://ory:ory-secret@postgres:5432/hydra?sslmode=disable

urls:
  self:
    issuer: http://localhost:4444
  consent: http://localhost:3000/consent
  login: http://localhost:3000/login
  logout: http://localhost:3000/logout
  error: http://localhost:3000/error
  post_logout_redirect: http://localhost:3000/

secrets:
  system:
    - your-system-secret-32-chars-long

oidc:
  subject_identifiers:
    supported_types:
      - public
      - pairwise
    pairwise:
      salt: your-salt-16-chars

oauth2:
  expose_internal_errors: true
  # Support for client certificate authentication (mTLS)
  client_credentials:
    default_grant_allowed_scope: false
  # PKCE support for Authorization Code Flow
  pkce:
    enforced: false
    enforced_for_public_clients: true

# Support for client certificate authentication with your self-signed PKI
strategies:
  access_token: jwt

# Client certificate authentication support
oauth2:
  client_credentials:
    default_grant_allowed_scope: false

# HTTP client configuration for outbound HTTPS calls
http:
  tls:
    # Force trust of your self-signed CA
    verify_certificates: true
    ca_cert_file: /etc/certs/ca.crt
    # Additional security settings
    min_version: "1.2"
    max_version: "1.3"
  timeout:
    read: 30s
    write: 30s
    idle: 120s

# TLS configuration for server endpoints
serve:
  public:
    tls:
      # Ready for HTTPS when needed
      enabled: false
      cert:
        path: /etc/certs/server.crt
      key:
        path: /etc/certs/server.key
      # Trust client certificates signed by your CA
      client_ca_file: /etc/certs/ca.crt
  admin:
    tls:
      enabled: false
      cert:
        path: /etc/certs/server.crt
      key:
        path: /etc/certs/server.key
      client_ca_file: /etc/certs/ca.crt

# mTLS client authentication
mtls:
  enabled: true
  ca_file: /etc/certs/ca.crt

log:
  level: debug
  format: json
